<!DOCTYPE html>
<html>
<head>
    <title>Local Storage Example</title>
</head>
<body>
    <form id="userForm">
        <label for="Selling Price">Selling Price:</label>
        <input type="tel" id="price" name="price" required><br><br>
       
        <label for="name">Product Name:</label>
        <input type="text" id="name" name="name" required><br><br>

        <input type="submit" value="Add Product">
    </form>

    <ul id='userList'></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
    <script>
        var userForm = document.getElementById('userForm');
        var userList = document.getElementById('userList');

        userForm.addEventListener('submit', function(event) {
            event.preventDefault();

            var name = document.getElementById('name').value;
            var price = document.getElementById('price').value; // Corrected from phone to price

            var userDetails = {
                name: name,
                price: price // Corrected from phone to price
            };
            
            axios.post("https://crudcrud.com/api/5363161e1134429e88ef329fc64b5cd3/appointment", userDetails)
            .then((response) => {
                displayUser(response.data._id, userDetails); // Display user after successful creation
            })
            .catch((err) => {
                document.body.innerHTML = document.body.innerHTML + "<h4>Something went wrong</h4>"
                console.log(err)
            })

            userForm.reset();
        });

        function displayUser(userKey, userDetails) {
            var userDiv = document.createElement('div');
            userDiv.innerHTML = `
                <p>Product Name: ${userDetails.name}</p>
                <p>Selling Price: ${userDetails.price}</p> <!-- Corrected from phone to price -->
                <button class="delete-button" data-key="${userKey}">Delete</button>
            `;

            userList.appendChild(userDiv);
        }

        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('delete-button')) {
                var keyToDelete = event.target.getAttribute('data-key');
                axios.delete(`https://crudcrud.com/api/5363161e1134429e88ef329fc64b5cd3/appointment/${keyToDelete}`)
                .then(() => {
                    event.target.parentElement.remove();
                })
                .catch((err) => {
                    console.log(err);
                });
            }
        });

        // Function to fetch and display existing users from the API on page load
        axios.get("https://crudcrud.com/api/5363161e1134429e88ef329fc64b5cd3/appointment")
        .then((response) => {
            response.data.forEach((item) => {
                displayUser(item._id, item);
            });
        })
        .catch((err) => {
            console.log(err);
        });
    </script>
</body>
</html>
